---
layout:         "default"
title:          "处理请求"
lead:           ""
---

#请求

###分类

请求分为3大类

1.  web页面。

    这类请求最为常见。包含的流程有：
        
    1.  初始化，参数获取，验证页面访问权限

    2.  调用数据，输出http头部，输出页面。

    3.  一般页面有固定结构，头部和尾部，导航之类的，是固定的，只有部分页面是固定的。

2.  ajax请求, 包括通过ajax请求包装的对话框。

    这类请求，配合在各个页面和用户做动态交互。输出的是和页面相关的结构化数据。

3.  api请求。

    这类请求为外部提供结构化的数据。

---

### 处理流程

处理这些请求，都要经过这些步骤：

1.  初始化

2.  验证权限

3.  主处理过程

4.  输出

5.  可能的错误处理

---

*   代码抽象如下:

    ```php
    abstract class MCore_Web_BaseApp
    {
        public function processRequest($request)
        {
            $this->request = $request;
            try
            {
                $this->init();
                $this->checkAuth();
                $this->main();
                $this->output();
            }
            catch (Exception $ex)
            {
                $this->processException($ex);
            }
        }
    }
    ```

### 抽象和封装

把处理请求的程序叫做App，他们都集成与 `MCore_Web_BaseApp`:

```
                             +-------------------+
                             | MCore_Web_BaseApp |
                             +-------------------+
                                      ^
                                      |
        +-------------------------------------------------------------+
        |  +-----------------------+    +-----------------------+     |    
        |  | MCore_Web_BasePageApp |    | MCore_Web_BaseAjaxApp |     |    
        |  +-----------------------+    +-----------------------+     |    
        |  +-----------------------+    +-------------------------+   |        
        |  | MCore_Web_BaseApiApp  |    | MCore_Web_BaseDialolApp |   |    
        |  +---------------------- +    +-------------------------+   |    
        +-------------------------------------------------------------+
```

根据路由生成的类名，都是派生于这四个基类的子类，调用他们的 `processRequest()`方法处理请求。

在这些子类内部有极大的自由空间，但是又受限于这几个父类。
